# CREATE AND CD INTO PROJECT PATH
mkdir {{ path }}
cd {{ path }}
echo Created directory `pwd`

# INITIALISE GIT REPO
git init
git remote add origin git@github.com:{{ config.git.user }}/{{ name }}.git
echo Added remote 'origin git@github.com:{{ config.git.user }}/{{ name }}.git'

# PLACE CMS
drush dl --drupal-project-rename=TEMPDRUPAL -q # uses Drush's cache
shopt -s dotglob # Allows us to move hidden files
mv TEMPDRUPAL/* .
shopt -u dotglob
rmdir TEMPDRUPAL
echo Drupal in place

# PLACE CIVICRM
{% for file in files %}
tar -xf {{ config.cache_path }}/civicrm-{{ civicrm_version }}-{{ file }} -C sites/all/modules
{% endfor %}
echo CiviCRM in place

# ADD SCOUT PROJECT FILE
scout dump project.yaml --full-name='{{ full_name|default(name) }}' > scout-project.yaml

# INITIAL COMMIT
DRUPAL_VERSION=`sed -n '2p' CHANGELOG.txt | cut -d ' ' -f 2 | cut -d ',' -f 1`
COMMIT_MESSAGE="New Scout project: CiviCRM at {{ civicrm_version }}; Drupal at $DRUPAL_VERSION"
git add .
git commit -q -m "$COMMIT_MESSAGE"
echo "Initial commit to repo with message: '$COMMIT_MESSAGE'"



# FINISH UP
echo Your new project is here:
echo {{ path }}
